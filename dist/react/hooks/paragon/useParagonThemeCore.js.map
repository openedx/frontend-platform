{"version":3,"file":"useParagonThemeCore.js","names":["useEffect","useState","logError","logInfo","fallbackThemeUrl","removeExistingLinks","useParagonThemeCore","_ref","themeCore","onLoad","_useState","_useState2","_slicedToArray","isParagonThemeCoreLoaded","setIsParagonThemeCoreLoaded","_useState3","_useState4","isBrandThemeCoreLoaded","setIsBrandThemeCoreLoaded","urls","getParagonThemeCoreLink","document","head","querySelector","existingCoreThemeLink","concat","brandCoreLink","brandOverride","getExistingCoreThemeLinks","isBrandOverride","coreThemeLinkSelector","querySelectorAll","createCoreThemeLink","url","_ref2","arguments","length","undefined","_ref2$isFallbackTheme","isFallbackThemeUrl","_ref2$isBrandOverride","coreThemeLink","createElement","href","rel","dataset","brandThemeCore","paragonThemeCore","onload","onerror","_PARAGON_THEME$parago","_PARAGON_THEME","otherExistingLinks","paragonThemeAccessor","themeUrls","PARAGON_THEME","core","coreThemeFallbackUrl","fileName","foundParagonThemeCoreLink","insertAdjacentElement","paragonCoreThemeLink","brandCoreThemeLink","removeAttribute"],"sources":["../../../../src/react/hooks/paragon/useParagonThemeCore.js"],"sourcesContent":["import { useEffect, useState } from 'react';\n\nimport { logError, logInfo } from '../../../logging';\nimport { fallbackThemeUrl, removeExistingLinks } from './utils';\n\n/**\n * Adds/updates a `<link>` element in the HTML document to load the core application theme CSS.\n *\n * @memberof module:React\n *\n * @param {object} args\n * @param {object} args.themeCore Object representing the core Paragon theme CSS.\n * @param {string} args.onLoad A callback function called when the core theme CSS is loaded.\n */\nconst useParagonThemeCore = ({\n  themeCore,\n  onLoad,\n}) => {\n  const [isParagonThemeCoreLoaded, setIsParagonThemeCoreLoaded] = useState(false);\n  const [isBrandThemeCoreLoaded, setIsBrandThemeCoreLoaded] = useState(false);\n\n  useEffect(() => {\n    // Call `onLoad` once both the paragon and brand theme core are loaded.\n    if (isParagonThemeCoreLoaded && isBrandThemeCoreLoaded) {\n      onLoad();\n    }\n  }, [isParagonThemeCoreLoaded, isBrandThemeCoreLoaded, onLoad]);\n\n  useEffect(() => {\n    // If there is no config for the core theme url, do nothing.\n    if (!themeCore?.urls) {\n      setIsParagonThemeCoreLoaded(true);\n      setIsBrandThemeCoreLoaded(true);\n      return;\n    }\n    const getParagonThemeCoreLink = () => document.head.querySelector('link[data-paragon-theme-core=\"true\"]');\n    const existingCoreThemeLink = document.head.querySelector(`link[href='${themeCore.urls.default}']`);\n    const brandCoreLink = document.head.querySelector(`link[href='${themeCore.urls.brandOverride}']`);\n    if (!existingCoreThemeLink) {\n      const getExistingCoreThemeLinks = (isBrandOverride) => {\n        const coreThemeLinkSelector = `link[data-${isBrandOverride ? 'brand' : 'paragon'}-theme-core=\"true\"]`;\n        return document.head.querySelectorAll(coreThemeLinkSelector);\n      };\n      const createCoreThemeLink = (\n        url,\n        {\n          isFallbackThemeUrl = false,\n          isBrandOverride = false,\n        } = {},\n      ) => {\n        let coreThemeLink = document.createElement('link');\n        coreThemeLink.href = url;\n        coreThemeLink.rel = 'stylesheet';\n        if (isBrandOverride) {\n          coreThemeLink.dataset.brandThemeCore = true;\n        } else {\n          coreThemeLink.dataset.paragonThemeCore = true;\n        }\n        coreThemeLink.onload = () => {\n          if (isBrandOverride) {\n            setIsBrandThemeCoreLoaded(true);\n          } else {\n            setIsParagonThemeCoreLoaded(true);\n          }\n        };\n        coreThemeLink.onerror = () => {\n          logError(`Failed to load core theme CSS from ${url}`);\n          if (isFallbackThemeUrl) {\n            logError(`Could not load core theme CSS from ${url} or fallback URL. Aborting.`);\n            if (isBrandOverride) {\n              setIsBrandThemeCoreLoaded(true);\n            } else {\n              setIsParagonThemeCoreLoaded(true);\n            }\n            const otherExistingLinks = getExistingCoreThemeLinks(isBrandOverride);\n            removeExistingLinks(otherExistingLinks);\n            return;\n          }\n          const paragonThemeAccessor = isBrandOverride ? 'brand' : 'paragon';\n          const themeUrls = PARAGON_THEME?.[paragonThemeAccessor]?.themeUrls ?? {};\n          if (themeUrls.core) {\n            const coreThemeFallbackUrl = fallbackThemeUrl(themeUrls.core.fileName);\n            logInfo(`Falling back to locally installed core theme CSS: ${coreThemeFallbackUrl}`);\n            coreThemeLink = createCoreThemeLink(coreThemeFallbackUrl, { isFallbackThemeUrl: true, isBrandOverride });\n            const otherExistingLinks = getExistingCoreThemeLinks(isBrandOverride);\n            removeExistingLinks(otherExistingLinks);\n            const foundParagonThemeCoreLink = getParagonThemeCoreLink();\n            if (foundParagonThemeCoreLink) {\n              foundParagonThemeCoreLink.insertAdjacentElement(\n                'afterend',\n                coreThemeLink,\n              );\n            } else {\n              document.head.insertAdjacentElement(\n                'afterbegin',\n                coreThemeLink,\n              );\n            }\n          } else {\n            logError(`Failed to load core theme CSS from ${url} or fallback URL. Aborting.`);\n          }\n        };\n        return coreThemeLink;\n      };\n\n      const paragonCoreThemeLink = createCoreThemeLink(themeCore.urls.default);\n      document.head.insertAdjacentElement(\n        'afterbegin',\n        paragonCoreThemeLink,\n      );\n\n      if (themeCore.urls.brandOverride) {\n        const brandCoreThemeLink = createCoreThemeLink(themeCore.urls.brandOverride, { isBrandOverride: true });\n        const foundParagonThemeCoreLink = getParagonThemeCoreLink();\n        if (foundParagonThemeCoreLink) {\n          foundParagonThemeCoreLink.insertAdjacentElement(\n            'afterend',\n            brandCoreThemeLink,\n          );\n        } else {\n          document.head.insertAdjacentElement(\n            'afterbegin',\n            brandCoreThemeLink,\n          );\n        }\n      } else {\n        setIsBrandThemeCoreLoaded(true);\n      }\n    } else {\n      existingCoreThemeLink.rel = 'stylesheet';\n      existingCoreThemeLink.removeAttribute('as');\n      existingCoreThemeLink.dataset.paragonThemeCore = true;\n      if (brandCoreLink) {\n        brandCoreLink.rel = 'stylesheet';\n        brandCoreLink.removeAttribute('as');\n        brandCoreLink.dataset.brandThemeCore = true;\n      }\n      setIsParagonThemeCoreLoaded(true);\n      setIsBrandThemeCoreLoaded(true);\n    }\n  }, [themeCore?.urls, onLoad]);\n};\n\nexport default useParagonThemeCore;\n"],"mappings":"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","ignoreList":[]}