{"version":3,"file":"AppProvider.js","names":["React","useState","useMemo","PropTypes","BrowserRouter","Router","OptionalReduxProvider","ErrorBoundary","AppContext","useAppEvent","useParagonTheme","useTrackColorSchemeChoice","paragonThemeActions","getAuthenticatedUser","AUTHENTICATED_USER_CHANGED","getConfig","CONFIG_CHANGED","getLocale","getMessages","IntlProvider","LOCALE_CHANGED","basename","SELECTED_THEME_VARIANT_KEY","AppProvider","_ref","store","children","wrapWithRouter","_useState","_useState2","_slicedToArray","config","setConfig","_useState3","_useState4","authenticatedUser","setAuthenticatedUser","_useState5","_useState6","locale","setLocale","_useParagonTheme","_useParagonTheme2","paragonThemeState","paragonThemeDispatch","appContextValue","paragonTheme","state","setThemeVariant","themeVariant","setParagonThemeVariant","window","localStorage","setItem","isThemeLoaded","createElement","messages","Provider","value","propTypes","shape","node","isRequired","bool","defaultProps"],"sources":["../../src/react/AppProvider.jsx"],"sourcesContent":["import React, { useState, useMemo } from 'react';\nimport PropTypes from 'prop-types';\nimport { BrowserRouter as Router } from 'react-router-dom';\n\nimport OptionalReduxProvider from './OptionalReduxProvider';\n\nimport ErrorBoundary from './ErrorBoundary';\nimport AppContext from './AppContext';\nimport {\n  useAppEvent,\n  useParagonTheme,\n  useTrackColorSchemeChoice,\n} from './hooks';\nimport { paragonThemeActions } from './reducers';\nimport { getAuthenticatedUser, AUTHENTICATED_USER_CHANGED } from '../auth';\nimport { getConfig } from '../config';\nimport { CONFIG_CHANGED } from '../constants';\nimport {\n  getLocale,\n  getMessages,\n  IntlProvider,\n  LOCALE_CHANGED,\n} from '../i18n';\nimport { basename } from '../initialize';\nimport { SELECTED_THEME_VARIANT_KEY } from './constants';\n\n/**\n * A wrapper component for React-based micro-frontends to initialize a number of common data/\n * context providers.\n *\n * ```\n * subscribe(APP_READY, () => {\n *   ReactDOM.render(\n *     <AppProvider>\n *       <HelloWorld />\n *     </AppProvider>\n *   )\n * });\n * ```\n *\n * This will provide the following to HelloWorld:\n * - An error boundary as described above.\n * - An `AppContext` provider for React context data.\n * - IntlProvider for @edx/frontend-i18n internationalization\n * - Optionally a redux `Provider`. Will only be included if a `store` property is passed to\n * `AppProvider`.\n * - A `Router` for react-router.\n * - A theme manager for Paragon.\n *\n * @param {Object} props\n * @param {Object} [props.store] A redux store.\n * @memberof module:React\n */\nexport default function AppProvider({ store, children, wrapWithRouter }) {\n  const [config, setConfig] = useState(getConfig());\n  const [authenticatedUser, setAuthenticatedUser] = useState(getAuthenticatedUser());\n  const [locale, setLocale] = useState(getLocale());\n\n  useAppEvent(AUTHENTICATED_USER_CHANGED, () => {\n    setAuthenticatedUser(getAuthenticatedUser());\n  });\n\n  useAppEvent(CONFIG_CHANGED, () => {\n    setConfig(getConfig());\n  });\n\n  useAppEvent(LOCALE_CHANGED, () => {\n    setLocale(getLocale());\n  });\n\n  useTrackColorSchemeChoice();\n  const [paragonThemeState, paragonThemeDispatch] = useParagonTheme(config);\n\n  const appContextValue = useMemo(() => ({\n    authenticatedUser,\n    config,\n    locale,\n    paragonTheme: {\n      state: paragonThemeState,\n      setThemeVariant: (themeVariant) => {\n        paragonThemeDispatch(paragonThemeActions.setParagonThemeVariant(themeVariant));\n\n        // Persist selected theme variant to localStorage.\n        window.localStorage.setItem(SELECTED_THEME_VARIANT_KEY, themeVariant);\n      },\n    },\n  }), [authenticatedUser, config, locale, paragonThemeState, paragonThemeDispatch]);\n\n  if (!paragonThemeState?.isThemeLoaded) {\n    return null;\n  }\n\n  return (\n    <IntlProvider locale={locale} messages={getMessages()}>\n      <ErrorBoundary>\n        <AppContext.Provider\n          value={appContextValue}\n        >\n          <OptionalReduxProvider store={store}>\n            {wrapWithRouter ? (\n              <Router basename={basename}>\n                <div data-testid=\"browser-router\">\n                  {children}\n                </div>\n              </Router>\n            ) : children}\n          </OptionalReduxProvider>\n        </AppContext.Provider>\n      </ErrorBoundary>\n    </IntlProvider>\n  );\n}\n\nAppProvider.propTypes = {\n  store: PropTypes.shape({}),\n  children: PropTypes.node.isRequired,\n  wrapWithRouter: PropTypes.bool,\n};\n\nAppProvider.defaultProps = {\n  store: null,\n  wrapWithRouter: true,\n};\n"],"mappings":"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","ignoreList":[]}