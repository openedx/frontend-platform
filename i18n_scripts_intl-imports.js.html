<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: i18n/scripts/intl-imports.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body data-module="">

<div id="main">
    <h1 class="page-title">Source: i18n/scripts/intl-imports.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>#!/usr/bin/env node

const scriptHelpDocument = `
NAME
  intl-imports.js — Script to generate the src/i18n/index.js file that exports messages from all the languages for Micro-frontends.

SYNOPSIS
  intl-imports.js [DIRECTORY ...]

DESCRIPTION
  This script is intended to run after 'atlas' has pulled the files.
  
  This expects to run inside a Micro-frontend root directory with the following structure:
  
    frontend-app-learning $ tree src/i18n/
    src/i18n/
    ├── index.js
    └── messages
        ├── frontend-app-example
        │   ├── ar.json
        │   ├── es_419.json
        │   └── zh_CN.json
        ├── frontend-component-footer
        │   ├── ar.json
        │   ├── es_419.json
        │   └── zh_CN.json
        └── frontend-component-header (empty directory)
  
  
  
  With the structure above it's expected to run with the following command in Makefile:
  
    
    $ node_modules/.bin/intl-imports.js frontend-component-footer frontend-component-header frontend-app-example
  
  
  It will generate two type of files:
  
   - Main src/i18n/index.js which overrides the Micro-frontend provided with a sample output of:
      
      """
      import messagesFromFrontendComponentFooter from './messages/frontend-component-footer';
      // Skipped import due to missing './messages/frontend-component-footer/index.js' likely due to empty translations.
      import messagesFromFrontendAppExample from './messages/frontend-app-example';
   
      export default [
        messagesFromFrontendComponentFooter,
        messagesFromFrontendAppExample,
      ];
      """
  
   - Each sub-directory has src/i18n/messages/frontend-component-header/index.js which is imported by the main file.:
   
      """
      import messagesOfArLanguage from './ar.json';
      import messagesOfDeLanguage from './de.json';
      import messagesOfEs419Language from './es_419.json';
      export default {
        'ar': messagesOfArLanguage,
        'de': messagesOfDeLanguage,
        'es-419': messagesOfEs419Language,
      };
     """
`;

const fs = require('fs');
const path = require('path');
const camelCase = require('lodash.camelcase');

const loggingPrefix = path.basename(`${__filename}`); // the name of this JS file

// Header note for generated src/i18n/index.js file
const filesCodeGeneratorNoticeHeader = `// This file is generated by the openedx/frontend-platform's "intl-import.js" script.
//
// Refer to the i18n documents in https://docs.openedx.org/en/latest/developers/references/i18n.html to update
// the file and use the Micro-frontend i18n pattern in new repositories.
//
`;

/**
 * Create frontend-app-example/index.js file with proper imports.
 *
 * @param directory - a directory name containing .json files from Transifex e.g. "frontend-app-example".
 * @param log - Mockable process.stdout.write
 * @param writeFileSync - Mockable fs.writeFileSync
 * @param i18nDir - Path to `src/i18n` directory
 *
 * @return object - An object containing directory name and whether its "index.js" file was successfully written.
 */
function generateSubdirectoryMessageFile({
  directory,
  log,
  writeFileSync,
  i18nDir,
}) {
  const importLines = [];
  const messagesLines = [];
  const counter = { nonEmptyLanguages: 0 };
  const messagesDir = `${i18nDir}/messages`; // The directory of Micro-frontend i18n messages

  try {
    const files = fs.readdirSync(`${messagesDir}/${directory}`, { withFileTypes: true });
    files.sort(); // Sorting ensures a consistent generated `index.js` order of imports cross-platforms.

    const jsonFiles = files.filter(file => file.isFile() &amp;&amp; file.name.endsWith('.json'));

    if (!jsonFiles.length) {
      log(`${loggingPrefix}: Not creating '${directory}/index.js' because no .json translation files were found.\n`);
      return {
        directory,
        isWritten: false,
      };
    }

    jsonFiles.forEach((file) => {
      const filename = file.name;
      // Gets `fr_CA` from `fr_CA.json`
      const languageCode = filename.replace(/\.json$/, '');
      // React-friendly language code fr_CA --> fr-ca
      const reactIntlLanguageCode = languageCode.toLowerCase().replace(/_/g, '-');
      // camelCase variable name
      const messagesCamelCaseVar = camelCase(`messages_Of_${languageCode}_Language`);
      const filePath = `${messagesDir}/${directory}/${filename}`;

      try {
        const entries = JSON.parse(fs.readFileSync(filePath, { encoding: 'utf8' }));

        if (!Object.keys(entries).length) {
          importLines.push(`// Note: Skipped empty '${filename}' messages file.`);
          return; // Skip the language
        }
      } catch (e) {
        importLines.push(`// Error: unable to parse '${filename}' messages file.`);
        log(`${loggingPrefix}: NOTICE: Skipping '${directory}/${filename}' due to error: ${e}.\n`);
        return; // Skip the language
      }

      counter.nonEmptyLanguages += 1;
      importLines.push(`import ${messagesCamelCaseVar} from './${filename}';`);
      messagesLines.splice(1, 0, `  '${reactIntlLanguageCode}': ${messagesCamelCaseVar},`);
    });

    if (counter.nonEmptyLanguages) {
      // See the help message above for sample output.
      const messagesFileContent = [
        filesCodeGeneratorNoticeHeader,
        importLines.join('\n'),
        '\nexport default {',
        messagesLines.join('\n'),
        '};\n',
      ].join('\n');

      writeFileSync(`${messagesDir}/${directory}/index.js`, messagesFileContent);
      return {
        directory,
        isWritten: true,
      };
    }
    log(`${loggingPrefix}: Skipping '${directory}' because no languages were found.\n`);
  } catch (e) {
    log(`${loggingPrefix}: NOTICE: Skipping '${directory}' due to error: ${e}.\n`);
  }

  return {
    directory,
    isWritten: false,
  };
}

/**
 * Create main `src/i18n/index.js` messages import file.
 *
 *
 * @param processedDirectories - List of directories with a boolean flag whether its "index.js" file is written
 *                               The format is "[\{ directory: "frontend-component-example", isWritten: false \}, ...]"
 * @param log - Mockable process.stdout.write
 * @param writeFileSync - Mockable fs.writeFileSync
 * @param i18nDir` - Path to `src/i18n` directory
 */
function generateMainMessagesFile({
  processedDirectories,
  log,
  writeFileSync,
  i18nDir,
}) {
  const importLines = [];
  const exportLines = [];

  processedDirectories.forEach(processedDirectory => {
    const { directory, isWritten } = processedDirectory;
    if (isWritten) {
      const moduleCamelCaseVariableName = camelCase(`messages_from_${directory}`);
      importLines.push(`import ${moduleCamelCaseVariableName} from './messages/${directory}';`);
      exportLines.push(`  ${moduleCamelCaseVariableName},`);
    } else {
      const skipMessage = `Skipped import due to missing '${directory}/index.js' likely due to empty translations.`;
      importLines.push(`// ${skipMessage}.`);
      log(`${loggingPrefix}: ${skipMessage}\n`);
    }
  });

  // See the help message above for sample output.
  const indexFileContent = [
    filesCodeGeneratorNoticeHeader,
    importLines.join('\n'),
    '\nexport default [',
    exportLines.join('\n'),
    '];\n',
  ].join('\n');

  writeFileSync(`${i18nDir}/index.js`, indexFileContent);
}

/*
 * Main function of the file.
 */
function main({
  directories,
  log,
  writeFileSync,
  pwd,
}) {
  const i18nDir = `${pwd}/src/i18n`; // The Micro-frontend i18n root directory

  if (directories.includes('--help') || directories.includes('-h')) {
    log(scriptHelpDocument);
  } else if (!directories.length) {
    log(scriptHelpDocument);
    log(`${loggingPrefix}: Error: A list of directories is required.\n`);
  } else if (!fs.existsSync(i18nDir) || !fs.lstatSync(i18nDir).isDirectory()) {
    log(scriptHelpDocument);
    log(`${loggingPrefix}: Error: src/i18n directory was not found.\n`);
  } else {
    const processedDirectories = directories.map(directory => generateSubdirectoryMessageFile({
      directory,
      log,
      writeFileSync,
      i18nDir,
    }));
    generateMainMessagesFile({
      processedDirectories,
      log,
      writeFileSync,
      i18nDir,
    });
  }
}

if (require.main === module) {
  // Run the main() function if called from the command line.
  main({
    directories: process.argv.slice(2),
    log: text => process.stdout.write(text),
    writeFileSync: fs.writeFileSync,
    pwd: process.env.PWD,
  });
}

module.exports.main = main; // Allow tests to use the main function.
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><ul class="list-unstyled nav flex-column"><li class="module-section nav-item Analytics">
                    <a href="module-Analytics.html" class="nav-link font-weight-bold">Analytics</a>
                    
            <ul class="list-unstyled px-3 pb-4 bg-light">
                <li><a href="module-Analytics.AnalyticsService.html">AnalyticsService</a></li><li><a href="module-Analytics.MockAnalyticsService.html">MockAnalyticsService</a></li><li><a href="module-Analytics.SegmentAnalyticsService.html">SegmentAnalyticsService</a></li><li><a href="module-Analytics.html#~configure">configure</a></li><li><a href="module-Analytics.html#~getAnalyticsService">getAnalyticsService</a></li><li><a href="module-Analytics.html#~identifyAnonymousUser">identifyAnonymousUser</a></li><li><a href="module-Analytics.html#~identifyAuthenticatedUser">identifyAuthenticatedUser</a></li><li><a href="module-Analytics.html#~resetAnalyticsService">resetAnalyticsService</a></li><li><a href="module-Analytics.html#~sendPageEvent">sendPageEvent</a></li><li><a href="module-Analytics.html#~sendTrackEvent">sendTrackEvent</a></li><li><a href="module-Analytics.html#~sendTrackingLogEvent">sendTrackingLogEvent</a></li>
            </ul>
        
                </li><li class="module-section nav-item Auth">
                    <a href="module-Auth.html" class="nav-link font-weight-bold">Auth</a>
                    
            <ul class="list-unstyled px-3 pb-4 bg-light">
                <li><a href="module-Auth.AuthService.html">AuthService</a></li><li><a href="module-Auth.AxiosJwtAuthService.html">AxiosJwtAuthService</a></li><li><a href="module-Auth.HttpClient.html">HttpClient</a></li><li><a href="module-Auth.MockAuthService.html">MockAuthService</a></li><li><a href="module-Auth.UserData.html">UserData</a></li><li><a href="module-Auth.html#~AUTHENTICATED_USER_TOPIC">AUTHENTICATED_USER_TOPIC</a></li><li><a href="module-Auth.html#~configure">configure</a></li><li><a href="module-Auth.html#~ensureAuthenticatedUser">ensureAuthenticatedUser</a></li><li><a href="module-Auth.html#~event:AUTHENTICATED_USER_CHANGED">AUTHENTICATED_USER_CHANGED</a></li><li><a href="module-Auth.html#~fetchAuthenticatedUser">fetchAuthenticatedUser</a></li><li><a href="module-Auth.html#~getAuthService">getAuthService</a></li><li><a href="module-Auth.html#~getAuthenticatedHttpClient">getAuthenticatedHttpClient</a></li><li><a href="module-Auth.html#~getAuthenticatedUser">getAuthenticatedUser</a></li><li><a href="module-Auth.html#~getHttpClient">getHttpClient</a></li><li><a href="module-Auth.html#~getLoginRedirectUrl">getLoginRedirectUrl</a></li><li><a href="module-Auth.html#~getLogoutRedirectUrl">getLogoutRedirectUrl</a></li><li><a href="module-Auth.html#~hydrateAuthenticatedUser">hydrateAuthenticatedUser</a></li><li><a href="module-Auth.html#~redirectToLogin">redirectToLogin</a></li><li><a href="module-Auth.html#~redirectToLogout">redirectToLogout</a></li><li><a href="module-Auth.html#~resetAuthService">resetAuthService</a></li><li><a href="module-Auth.html#~setAuthenticatedUser">setAuthenticatedUser</a></li>
            </ul>
        
                </li><li class="module-section nav-item Config">
                    <a href="module-Config.html" class="nav-link font-weight-bold">Config</a>
                    
            <ul class="list-unstyled px-3 pb-4 bg-light">
                <li><a href="module-Config.html#.ConfigDocument">ConfigDocument</a></li><li><a href="module-Config.html#~ensureConfig">ensureConfig</a></li><li><a href="module-Config.html#~getConfig">getConfig</a></li><li><a href="module-Config.html#~mergeConfig">mergeConfig</a></li><li><a href="module-Config.html#~setConfig">setConfig</a></li>
            </ul>
        
                </li><li class="module-section nav-item Initialization">
                    <a href="module-Initialization.html" class="nav-link font-weight-bold">Initialization</a>
                    
            <ul class="list-unstyled px-3 pb-4 bg-light">
                <li><a href="module-Initialization.html#~analytics">analytics</a></li><li><a href="module-Initialization.html#~auth">auth</a></li><li><a href="module-Initialization.html#~history">history</a></li><li><a href="module-Initialization.html#~initError">initError</a></li><li><a href="module-Initialization.html#~initialize">initialize</a></li>
            </ul>
        
                </li><li class="module-section nav-item Internationalization">
                    <a href="module-Internationalization.html" class="nav-link font-weight-bold">Internationalization</a>
                    
            <ul class="list-unstyled px-3 pb-4 bg-light">
                <li><a href="module-Internationalization.html#.LOCALE_CHANGED">LOCALE_CHANGED</a></li><li><a href="module-Internationalization.html#.LOCALE_TOPIC">LOCALE_TOPIC</a></li><li><a href="module-Internationalization.html#.configure">configure</a></li><li><a href="module-Internationalization.html#.findSupportedLocale">findSupportedLocale</a></li><li><a href="module-Internationalization.html#.getCookies">getCookies</a></li><li><a href="module-Internationalization.html#.getLocale">getLocale</a></li><li><a href="module-Internationalization.html#.getMessages">getMessages</a></li><li><a href="module-Internationalization.html#.getPrimaryLanguageSubtag">getPrimaryLanguageSubtag</a></li><li><a href="module-Internationalization.html#.handleRtl">handleRtl</a></li><li><a href="module-Internationalization.html#.isRtl">isRtl</a></li><li><a href="module-Internationalization.html#.mergeMessages">mergeMessages</a></li><li><a href="module-Internationalization-FormattedDate.html">FormattedDate</a></li><li><a href="module-Internationalization-FormattedMessage.html">FormattedMessage</a></li><li><a href="module-Internationalization-FormattedNumber.html">FormattedNumber</a></li><li><a href="module-Internationalization-FormattedPlural.html">FormattedPlural</a></li><li><a href="module-Internationalization-FormattedRelativeTime.html">FormattedRelativeTime</a></li><li><a href="module-Internationalization-FormattedTime.html">FormattedTime</a></li><li><a href="module-Internationalization-IntlProvider.html">IntlProvider</a></li><li><a href="module-Internationalization.html#~createIntl">createIntl</a></li><li><a href="module-Internationalization.html#~defineMessages">defineMessages</a></li><li><a href="module-Internationalization.html#~useIntl">useIntl</a></li>
            </ul>
        
                </li><li class="module-section nav-item Logging">
                    <a href="module-Logging.html" class="nav-link font-weight-bold">Logging</a>
                    
            <ul class="list-unstyled px-3 pb-4 bg-light">
                <li><a href="module-Logging.LoggingService.html">LoggingService</a></li><li><a href="module-Logging.MockLoggingService.html">MockLoggingService</a></li><li><a href="module-Logging.NewRelicLoggingService.html">NewRelicLoggingService</a></li><li><a href="module-Logging.html#~configure">configure</a></li><li><a href="module-Logging.html#~getLoggingService">getLoggingService</a></li><li><a href="module-Logging.html#~logError">logError</a></li><li><a href="module-Logging.html#~logInfo">logInfo</a></li><li><a href="module-Logging.html#~resetLoggingService">resetLoggingService</a></li>
            </ul>
        
                </li><li class="module-section nav-item PubSub">
                    <a href="module-PubSub.html" class="nav-link font-weight-bold">PubSub</a>
                    
            <ul class="list-unstyled px-3 pb-4 bg-light">
                <li><a href="module-PubSub.html#~publish">publish</a></li><li><a href="module-PubSub.html#~subscribe">subscribe</a></li><li><a href="module-PubSub.html#~unsubscribe">unsubscribe</a></li>
            </ul>
        
                </li><li class="module-section nav-item React">
                    <a href="module-React.html" class="nav-link font-weight-bold">React</a>
                    
            <ul class="list-unstyled px-3 pb-4 bg-light">
                <li><a href="module-React.html#.AppContext">AppContext</a></li><li><a href="module-React.html#.AppProvider">AppProvider</a></li><li><a href="module-React.html#.AuthenticatedPageRoute">AuthenticatedPageRoute</a></li><li><a href="module-React.ErrorBoundary.html">ErrorBoundary</a></li><li><a href="module-React.html#.ErrorPage">ErrorPage</a></li><li><a href="module-React.html#.LoginRedirect">LoginRedirect</a></li><li><a href="module-React.html#.OptionalReduxProvider">OptionalReduxProvider</a></li><li><a href="module-React.html#.PageRoute">PageRoute</a></li><li><a href="module-React.html#.useAppEvent">useAppEvent</a></li><li><a href="module-React.html#.useTrackColorSchemeChoice">useTrackColorSchemeChoice</a></li>
            </ul>
        
                </li><li class="module-section nav-item Testing">
                    <a href="module-Testing.html" class="nav-link font-weight-bold">Testing</a>
                    
            <ul class="list-unstyled px-3 pb-4 bg-light">
                <li><a href="module-Testing.html#.initializeMockApp">initializeMockApp</a></li><li><a href="module-Testing.html#.messages">messages</a></li>
            </ul>
        
                </li><li class="module-section nav-item Utilities">
                    <a href="module-Utilities.html" class="nav-link font-weight-bold">Utilities</a>
                    
            <ul class="list-unstyled px-3 pb-4 bg-light">
                <li><a href="module-Utilities.html#~camelCaseObject">camelCaseObject</a></li><li><a href="module-Utilities.html#~convertKeyNames">convertKeyNames</a></li><li><a href="module-Utilities.html#~ensureDefinedConfig">ensureDefinedConfig</a></li><li><a href="module-Utilities.html#~getQueryParameters">getQueryParameters</a></li><li><a href="module-Utilities.html#~modifyObjectKeys">modifyObjectKeys</a></li><li><a href="module-Utilities.html#~snakeCaseObject">snakeCaseObject</a></li>
            </ul>
        
                </li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.0</a> on Tue May 02 2023 19:34:03 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
